{% extends "base.html" %}

{% block title %}{{ post.title }} - Blog{% endblock %}

{% block content %}
<!-- Header -->
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 50px 40px; border-radius: 15px; margin-bottom: 40px;">
    <a href="/blog" class="btn btn-light btn-sm mb-3">
        <i class="fas fa-arrow-left"></i> Back to Blog
    </a>
    <h1 class="display-5 mt-3 mb-3">{{ post.title }}</h1>
    <p class="lead mb-3">{{ post.description }}</p>
    <div class="d-flex gap-4">
        <small>
            <i class="fas fa-calendar"></i> {{ post.created_at[:10] }}
        </small>
        <small>
            <i class="fas fa-eye"></i> {{ post.views }} views
        </small>
    </div>
</div>

<!-- Content -->
<div class="card">
    <div class="card-body p-5">
        <article class="blog-content">
            <div id="content"></div>
        </article>
    </div>
</div>

<!-- Footer -->
<div class="text-center mt-5 mb-5">
    <a href="/blog" class="btn btn-primary btn-lg btn-custom">
        <i class="fas fa-arrow-left"></i> Back to All Articles
    </a>
</div>

<style>
.blog-content {
    line-height: 1.8;
    font-size: 1.05em;
    color: #333;
}

.blog-content h1 {
    font-size: 2em;
    margin-top: 40px;
    margin-bottom: 20px;
    color: #667eea;
    border-bottom: 3px solid #667eea;
    padding-bottom: 10px;
}

.blog-content h2 {
    font-size: 1.6em;
    margin-top: 35px;
    margin-bottom: 18px;
    color: #667eea;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 8px;
}

.blog-content h3 {
    font-size: 1.3em;
    margin-top: 25px;
    margin-bottom: 15px;
    color: #555;
}

.blog-content p {
    margin-bottom: 18px;
    line-height: 1.8;
}

.blog-content ul, .blog-content ol {
    margin: 20px 0;
    padding-left: 30px;
}

.blog-content li {
    margin-bottom: 10px;
}

.blog-content code {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #d63384;
    font-size: 0.95em;
}

.blog-content pre {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    margin: 25px 0;
}

.blog-content pre code {
    background: transparent;
    padding: 0;
    color: #333;
    display: block;
}

.blog-content blockquote {
    border-left: 4px solid #667eea;
    padding-left: 20px;
    margin: 25px 0;
    font-style: italic;
    color: #666;
}

.blog-content a {
    color: #667eea;
    text-decoration: none;
}

.blog-content a:hover {
    text-decoration: underline;
}

.blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 20px 0;
}

.blog-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 25px 0;
}

.blog-content table th,
.blog-content table td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

.blog-content table th {
    background: #f8f9fa;
    font-weight: 600;
}
</style>

<script>
// Parse and render content properly
document.addEventListener('DOMContentLoaded', function() {
    const rawContent = {{ post.content | tojson | safe }};
    const contentDiv = document.getElementById('content');
    
    // Convert markdown-style content to HTML
    let html = rawContent;
    
    // Convert headers (## Header -> <h2>Header</h2>)
    html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
    html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
    html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
    
    // Convert code blocks (`````` -> <pre><code>code</code></pre>)
    html = html.replace(/``````/g, '<pre><code>$2</code></pre>');
    html = html.replace(/``````/g, '<pre><code>$1</code></pre>');
    
    // Convert inline code (`code` -> <code>code</code>)
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // Convert bold (**text** -> <strong>text</strong>)
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    
    // Convert italic (*text* -> <em>text</em>)
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
    
    // Convert bullet lists
    html = html.replace(/^\* (.+)$/gm, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
    
    // Convert numbered lists  
    html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
    
    // Convert paragraphs (double newline -> new paragraph)
    html = html.split('\n\n').map(para => {
        para = para.trim();
        if (!para) return '';
        // Don't wrap if already has block-level tags
        if (para.match(/^<(h[1-6]|ul|ol|pre|blockquote|div)/)) {
            return para;
        }
        return '<p>' + para.replace(/\n/g, '<br>') + '</p>';
    }).join('\n');
    
    contentDiv.innerHTML = html;
});
</script>

{% endblock %}
